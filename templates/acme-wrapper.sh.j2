#!/bin/sh
#################################################################
# (C) 2017, Inofix GmbH, Michael Lustenberger - see /LICENSE
#################################################################
# This is a wrapper script to limit ssh connections to use
# only a subset of the features of acme-control.sh
#################################################################

# consider 3 parts, use the last 2
args="${SSH_ORIGINAL_COMMAND#* }"
# consider the first part to be a command
action="${args%% *}"
# consider the last part to be the argument
certname="${args##* }"
# (ignoring any pot. middle of the string)

# control what the ssh user can do
case "$action" in
    get_cert*)
        {{ acme__bin_dir }}/acme-control.sh $action $certname
    ;;
    get_ca)
        {{ acme__bin_dir }}/acme-control.sh $action $certname
    ;;
    *)
        echo "usage: this wrapper script is thought to be used"
        echo "on ssh-connections to restrict access to acme-control.sh"
        echo "please log in as the acme user providing a supported action"
        echo "and an existing certificate name."
        exit 1
    ;;
esac

